<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RustDesk Web Console</title>
    <style>
        :root {
            --primary-color: #3a7bd5; /* A modern blue shade */
            --secondary-color: #ffffff; /* White for text on blue */
            --background-color: #f9fafc; /* Light neutral background */
            --text-color: #1a202c; /* Dark gray for text */
            --sidebar-width: 200px; /* Slimmer sidebar */
            --font-heading: "Poppins", sans-serif; /* Modern, clean font */
            --font-sans: "Roboto", sans-serif; /* Easy-to-read font */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-color);
            color: var(--secondary-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1rem 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            border-right: 1px solid #ccc; /* Separator between sidebar and content */
        }

        .title {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            font-family: var(--font-heading);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }


        .sidebar .devices {
            flex: 1;
            padding: 0 1rem;
        }

        .sidebar .devices-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .sidebar .devices-header h3 {
            font-size: 1rem;
            font-family: var(--font-heading);
        }

        .sidebar .devices-header .add-button {
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .sidebar .devices-header .add-button:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        .sidebar .devices ul {
            list-style: none;
        }

        .sidebar .devices ul li {
            padding: 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }

        .sidebar .devices ul li:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .sidebar .footer {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar .footer a {
            color: var(--secondary-color);
            text-decoration: none;
            display: block;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            overflow-y: auto;
        }

        .main-header {
            display: flex;
            align-items: center; /* Vertically center all children */
            gap: 1rem; /* Optional: spacing between elements */
        }

        .main-header h2 {
            font-size: 1.5rem;
            font-family: var(--font-heading);
            margin-bottom: 0; /* Remove extra margin */
            line-height: 1;   /* Tighter line height */
            display: flex;
            align-items: center; /* Vertically center text with input */
        }

        .search-container {
            margin-right: auto; /* Push the search bar to the left of the logo */
            display: flex;
            align-items: center; /* Align with the logo vertically */
            padding: 5px;
        }

        .search-container input {
            padding: 0.5rem;
            font-size: 0.9rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 250px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Add subtle shadow */
            transition: box-shadow 0.3s ease, border-color 0.3s ease; /* Smooth hover effect */
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--primary-color); /* Highlight border on focus */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Enhance shadow on focus */
        }

        .main-header .rustdesk-title {
            display: flex;
            margin-bottom: 0;
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .main-header .rustdesk-title img {
            height: 32px;
            margin-right: 0.5rem;
            display: inline-block;
            align-self: center; /* Center logo vertically in flex container */
        }

        .main-header .rustdesk-title span {
            display: flex;
            align-items: center; /* Center text vertically with logo */
        }

        .computer-list {
            width: 100%;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 0.9rem;
        }

        .computer-list th, .computer-list td {
            padding: 0.8rem;
            text-align: left;
        }

        .computer-list th {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            font-family: var(--font-sans); /* Changed to Roboto for better clarity */
            font-weight: 500; /* Slightly bolder for emphasis */
        }

        .computer-list tr:nth-child(even) {
            background-color: #f1f5f9;
        }

        .computer-list tr:hover {
            background-color: #e2e8f0;
        }

        .pw-toggle {
            display: flex;
            align-items: center;
            gap: 0.3em;
            width: 150px; /* Set a fixed width to prevent shifting */
            justify-content: space-between; /* Ensure proper alignment */
        }

        .id-toggle {
            display: flex;
            align-items: center;
            gap: 0.3em;
        }

        .pw-icon {
            cursor: pointer;
            font-size: 1.1em;
            color: #888; /* Match copy icon color */
            user-select: none;
            transition: color 0.2s;
        }

        .pw-icon:hover {
            color: #3a7bd5;
        }

        .pw-copy, .id-copy {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #888;
            margin-left: 0.2em;
            padding: 0 0.2em;
            transition: color 0.2s;
        }

        .pw-copy:hover, .id-copy:hover {
            color: #3a7bd5;
        }

        .pw-value, .pw-raw {
            font-family: 'Roboto Mono', monospace;
            font-size: 1em;
            white-space: nowrap; /* Prevent wrapping */
            overflow: hidden; /* Hide overflow if necessary */
            text-overflow: ellipsis; /* Add ellipsis for long text */
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 80px;
            background-color: #3a7bd5;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -40px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tooltip.show .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-popup {
            position: fixed;
            background-color: #3a7bd5;
            color: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-btn {
            border: none;
            border-radius: 10px; /* Reduced roundness for a balanced look */
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color 0.3s ease; /* Smooth transitions */
            margin-right: 10px; /* Added a small gap between buttons */
        }

        .action-btn:hover {
            box-shadow: none; /* No shadow effect */
        }

        .edit-btn {
            background-color: #bdbdbd; /* Darker grey for better contrast */
            color: #333; /* Dark text for contrast */
        }

        .edit-btn:hover {
            background-color: #a6a6a6; /* Slightly darker grey on hover */
        }

        .connect-btn {
            background-color: #007bff; /* Modern blue */
            color: #fff; /* White text */
        }

        .connect-btn:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }

        /* Popup Modal for Editing Connections */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-family: 'Roboto', sans-serif; /* Match the website's font */
        }

        .close-btn {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-content h2 {
            margin-top: 0;
        }

        .modal-content label {
            display: block;
            margin: 10px 0 5px;
        }

        .modal-content input,
        .modal-content textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: 'Roboto', sans-serif; /* Match the website's font */
            font-size: 0.9rem; /* Ensure consistent font size */
        }

        .modal-content textarea {
            resize: vertical; /* Restrict resizing to vertical only */
        }

        .action-btn.save-btn {
            background-color: #007bff;
            color: #fff;
        }

        .action-btn.cancel-btn {
            background-color: #e0e0e0;
            color: #333;
        }

        .action-btn.new-group-btn {
           font-size: 1.2rem;
           font-weight: 600;
           padding: 0px;
        }

        .action-btn {
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            margin-right: 10px;
        }

        .group-separator {
            border-top: 1px solid #ccc; /* Separator between 'All Devices' and groups */
            margin: 10px 0;
        }

        .main {
            display: flex;
            flex-direction: column;
        }

        .content {
            display: flex;
            flex-direction: row;
        }

        .table-container {
            flex: 3;
            margin-right: 20px;
        }

        .notifications-bar {
            flex: 1;
            background-color: #f9fafc; /* Match the main background */
            border-left: 1px solid #e0e0e0;
            padding: 10px; /* Reduced padding */
            box-shadow: none; /* Removed shadow */
            border-radius: 4px; /* Reduced border radius */
            font-size: 0.9rem; /* Slightly smaller font size */
        }

        .notifications-bar h3 {
            margin-top: 0;
            font-size: 1.2rem; /* Slightly smaller heading */
            color: #333;
            padding-bottom: 5px; /* Removed border-bottom */
        }

        .notifications-list {
            list-style: none;
            padding: 0;
        }

        .notifications-list li {
            justify-content: space-between;
            align-items: center;
            padding: 8px; /* Reduced padding */
            margin-bottom: 8px; /* Reduced margin */
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px; /* Reduced border radius */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Subtle shadow */
            transition: box-shadow 0.3s ease;
        }

        .notifications-list .time {
            font-size: 0.8rem; /* Smaller font size */
            color: #888;
            margin-right: 10px;
        }

        .notifications-list .message {
            font-size: 0.9rem; /* Slightly smaller font size */
            color: #333;
        }

        .computer-list th:last-child, .computer-list td:last-child {
            width: 200px; /* Adjusted width for the Actions column */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Added FontAwesome for better icons -->
</head>
<body>
    <div class="sidebar">
        <div class="title">
            rustweb
        </div>
        <div class="devices">
            <div class="devices-header">
                <h3>Device Groups</h3>
                <span class="action-btn new-group-btn">+</span>
            </div>
            <ul>
                <li>All Devices</li>
                <li>Group 1</li>
                <li>Group 2</li>
            </ul>
        </div>
        <div class="footer">
            <a href="#">Settings</a>
            <a href="#">Log Out</a>
        </div>
    </div>
    <div class="main">
        <div class="main-header">
            <h2>All Devices</h2>

            <div class="search-container">
                <input type="text" placeholder="Search devices...">
            </div>

            <div class="rustdesk-title">
                <a href="https://rustdesk.com/" target="_blank">
                    <img src="/images/rustdesk-logo.svg" alt="RustDesk Logo">
                </a>
                rustdesk
            </div>
        </div>
        <div class="content">
            <div class="table-container">
                <table class="computer-list">
                    <thead>
                        <tr>
                            <th>RustDesk ID</th>
                            <th>Device Name</th>
                            <th>Created</th>
                            <th>Password</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for device in devices %}
                        <tr>
                            <td><span class="id-toggle">{{ device['id'] }}<button class="id-copy" title="Copy ID"><i class="fas fa-copy"></i></button></span></td>
                            <td>{{ device['name'] }}</td>
                            <td>{{ device['created_at'] }}</td>
                            <td><span class="pw-toggle"><span class="pw-value">•••••••••</span><span class="pw-raw" style="display:none;">{{ device['password'] }}</span><i class="fas fa-eye pw-icon" title="Show password"></i><button class="pw-copy" title="Copy password"><i class="fas fa-copy"></i></button></span></td>
                            <td>{{ device['notes'] }}</td>
                            <td>
                                <button class="action-btn edit-btn" title="Edit Device">Edit</button>
                                <a href="rustdesk://{{ device['id'] }}?password={{ device['password'] }}" class="action-btn connect-btn" title="Connect to Device">Connect</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="notifications-bar">
                <h3>Notifications</h3>
                <ul class="notifications-list">
                    {% for log in logs %}
                        <li><strong style="display: inline-block; margin-right: 5px;">{{ log['created_at'][:10] }}</strong> {{ log['action'] }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Popup Modal for Editing Connections -->
        <div id="edit-connection-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2 style="font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 1.5rem;">Edit Device</h2>
                <div style="margin: 20px 0 15px;">
                    <span id="device-id-title" style="display: block; padding: 10px; background-color: #f1f5f9; border: 1px solid #ccc; border-radius: 4px; font-family: 'Roboto Mono', monospace; font-size: 1.1rem; font-weight: bold; text-align: center;">N/A</span>
                </div>
                <form id="edit-connection-form">
                    <label for="device-name">Device Name:</label>
                    <input type="text" id="device-name" name="device-name" required>

                    <label for="device-password">Password:</label>
                    <input type="text" id="device-password" name="device-password" required>

                    <label for="device-notes">Notes:</label>
                    <textarea id="device-notes" name="device-notes" rows="4"></textarea>

                    <button type="submit" class="action-btn save-btn">Save</button>
                    <button type="button" class="action-btn cancel-btn">Cancel</button>
                </form>
            </div>
        </div>

        <!-- Popup Modal for Adding New Group -->
        <div id="new-group-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>New Group</h2>
                <form id="new-group-form">
                    <label for="group-name">Group Name:</label>
                    <input type="text" id="group-name" name="group-name" required>

                    <button type="submit" class="action-btn save-btn">Create</button>
                    <button type="button" class="action-btn cancel-btn">Cancel</button>
                </form>
            </div>
        </div>

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.querySelector('.search-container input');
            const table = document.querySelector('.computer-list');
            const tbody = table.querySelector('tbody');
            // Store all rows for filtering
            const allRows = Array.from(tbody.querySelectorAll('tr'));

            searchInput.addEventListener('input', function() {
                const query = searchInput.value.trim().toLowerCase();
                tbody.innerHTML = '';
                allRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    // Search by Device, ID, Notes (columns 0, 1, 4)
                    const device = cells[0].textContent.toLowerCase();
                    const id = cells[1].textContent.toLowerCase();
                    const notes = cells[4].textContent.toLowerCase();
                    if (
                        device.includes(query) ||
                        id.includes(query) ||
                        notes.includes(query)
                    ) {
                        tbody.appendChild(row);
                    }
                });
                // If no match, show a message
                if (!tbody.hasChildNodes()) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    td.colSpan = 6;
                    td.textContent = 'No devices found.';
                    td.style.textAlign = 'center';
                    tr.appendChild(td);
                    tbody.appendChild(tr);
                }
            });

            // Password toggle logic
            document.querySelectorAll('.pw-toggle .pw-icon').forEach(function(icon) {
                icon.addEventListener('click', function() {
                    const pwToggle = icon.parentElement;
                    const pwValue = pwToggle.querySelector('.pw-value');
                    const pwRaw = pwToggle.querySelector('.pw-raw');
                    if (pwRaw.style.display === 'none') {
                        pwRaw.style.display = 'inline';
                        pwValue.style.display = 'none';
                        icon.title = 'Hide password';
                    } else {
                        pwRaw.style.display = 'none';
                        pwValue.style.display = 'inline';
                        icon.title = 'Show password';
                    }
                });
            });

            // Copy text fallback function
            function copyTextFallback(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    console.log('Fallback: Text copied to clipboard');
                } catch (err) {
                    console.error('Fallback: Unable to copy text', err);
                }
                document.body.removeChild(textarea);
            }

            function showPopupTooltip(message, x, y) {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip-popup';
                tooltip.textContent = message;
                document.body.appendChild(tooltip);

                tooltip.style.left = `${x}px`;
                tooltip.style.top = `${y - 40}px`;
                tooltip.style.opacity = '1';

                setTimeout(() => {
                    tooltip.style.opacity = '0';
                    setTimeout(() => document.body.removeChild(tooltip), 300);
                }, 1200);
            }

            // Copy password logic
            document.querySelectorAll('.pw-toggle .pw-copy').forEach(function(btn) {
                btn.addEventListener('click', function(event) {
                    const pwToggle = btn.parentElement;
                    const pwRaw = pwToggle.querySelector('.pw-raw');
                    if (pwRaw) {
                        const password = pwRaw.textContent.trim(); // Ensure no extra spaces
                        if (navigator.clipboard && navigator.clipboard.writeText) {
                            navigator.clipboard.writeText(password).then(function() {
                                showPopupTooltip('Copied!', event.clientX, event.clientY);
                            }).catch(function(err) {
                                console.error('Failed to copy password:', err);
                            });
                        } else {
                            copyTextFallback(password);
                            showPopupTooltip('Copied!', event.clientX, event.clientY);
                        }
                    }
                });
            });

            // Copy ID logic
            document.querySelectorAll('.id-toggle .id-copy').forEach(function(btn) {
                btn.addEventListener('click', function(event) {
                    const idToggle = btn.parentElement;
                    const id = idToggle.firstChild.textContent.trim(); // Ensure no extra spaces
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(id).then(function() {
                            showPopupTooltip('Copied!', event.clientX, event.clientY);
                        }).catch(function(err) {
                            console.error('Failed to copy ID:', err);
                        });
                    } else {
                        copyTextFallback(id);
                        showPopupTooltip('Copied!', event.clientX, event.clientY);
                    }
                });
            });

            const modal = document.getElementById('edit-connection-modal');
            const closeModal = modal.querySelector('.close-btn');
            const cancelBtn = modal.querySelector('.cancel-btn');

            // Open modal function
            function openModal() {
                modal.style.display = 'flex';
            }

            // Close modal function
            function closeModalHandler() {
                modal.style.display = 'none';
            }

            closeModal.addEventListener('click', closeModalHandler);
            cancelBtn.addEventListener('click', closeModalHandler);

            // Open modal on edit button click
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Populate modal fields with current values
                    const row = button.closest('tr');
                    const deviceName = row.querySelector('td:nth-child(1)').textContent;
                    const password = row.querySelector('.pw-raw').textContent;
                    const notes = row.querySelector('td:nth-child(5)').textContent;
                    const deviceId = row.querySelector('.id-toggle').textContent.trim(); // Get the device ID

                    document.getElementById('device-name').value = deviceName;
                    document.getElementById('device-password').value = password;
                    document.getElementById('device-notes').value = notes;
                    document.getElementById('device-id-title').textContent = deviceId; // Set the device ID in the modal

                    openModal();
                });
            });

            // Save edited connection
            document.getElementById('edit-connection-form').addEventListener('submit', function(e) {
                e.preventDefault();
                // Get updated values
                const deviceName = document.getElementById('device-name').value;
                const password = document.getElementById('device-password').value;
                const notes = document.getElementById('device-notes').value;

                // Here you would typically send the updated data to the server
                console.log('Updated Device Name:', deviceName);
                console.log('Updated Password:', password);
                console.log('Updated Notes:', notes);

                // Close the modal
                closeModalHandler();
            });

            const newGroupModal = document.getElementById('new-group-modal');
            const closeNewGroupModal = newGroupModal.querySelector('.close-btn');
            const cancelNewGroupBtn = newGroupModal.querySelector('.cancel-btn');

            // Open modal function
            function openNewGroupModal() {
                newGroupModal.style.display = 'flex';
            }

            // Close modal function
            function closeNewGroupModalHandler() {
                newGroupModal.style.display = 'none';
            }

            closeNewGroupModal.addEventListener('click', closeNewGroupModalHandler);
            cancelNewGroupBtn.addEventListener('click', closeNewGroupModalHandler);

            // Example: Open modal on button click
            document.querySelector('.new-group-btn').addEventListener('click', openNewGroupModal);
        });
        </script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
        $(document).ready(function() {
            $('.edit-btn').on('click', function() {
                const row = $(this).closest('tr');
                const deviceId = row.find('td:nth-child(1)').text().trim(); // Fetch ID from the first column
                const deviceName = row.find('td:nth-child(2)').text().trim(); // Fetch Name from the second column
                const password = row.find('.pw-raw').text().trim();
                const notes = row.find('td:nth-child(5)').text().trim();

                // Open modal and populate fields
                $('#device-id-title').text(deviceId); // Set the device ID in the title
                $('#device-name').val(deviceName); // Set the device name in the input field
                $('#device-password').val(password);
                $('#device-notes').val(notes);
                $('#edit-connection-modal').data('device-id', deviceId).show();
            });

            $('#edit-connection-form').on('submit', function(e) {
                e.preventDefault();

                const deviceId = $('#edit-connection-modal').data('device-id');
                const updatedName = $('#device-name').val();
                const updatedPassword = $('#device-password').val();
                const updatedNotes = $('#device-notes').val();

                // Send AJAX request to update the device
                $.ajax({
                    url: '/update_device',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        id: deviceId,
                        name: updatedName,
                        password: updatedPassword,
                        notes: updatedNotes
                    }),
                    success: function(response) {
                        if (response.status === 'success') {
                            // Update the table row with new values
                            const row = $(`td:contains(${deviceId})`).closest('tr'); // Match ID in the first column
                            row.find('td:nth-child(2)').text(updatedName); // Update Name in the second column
                            row.find('.pw-raw').text(updatedPassword);
                            row.find('td:nth-child(5)').text(updatedNotes);

                            // Close the modal
                            $('#edit-connection-modal').hide();
                        } else {
                            alert('Failed to update device: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('An error occurred while updating the device.');
                    }
                });
            });

            $('.close-btn, .cancel-btn').on('click', function() {
                $('#edit-connection-modal').hide();
            });

            $('.connect-btn').on('click', function(e) {
                const row = $(this).closest('tr');
                const deviceId = row.find('td:nth-child(1)').text().trim(); // Fetch ID from the first column


                // Send AJAX request to log the connection in the database
                $.ajax({
                    url: '/log_connection',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        id: deviceId,
                        message: `Started connection with ${deviceId}`
                    }),
                });
            });
        });
        </script>
</body>
</html>